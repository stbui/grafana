<query-editor-row ng-if="ctrl.datasource.is2x" query-ctrl="ctrl" can-collapse="true" has-text-edit-mode="true">
  <flux-query-editor target="ctrl.target" change="ctrl.onChange" refresh="ctrl.onRunQuery"></flux-query-editor>
</query-editor-row>

<query-editor-row ng-if="!ctrl.datasource.is2x" query-ctrl="ctrl" can-collapse="true" has-text-edit-mode="true">
  <div ng-if="ctrl.target.rawQuery">
    <div class="gf-form">
      <textarea rows="3" class="gf-form-input" ng-model="ctrl.target.query" spellcheck="false"
        placeholder="InfluxDB Query" ng-model-onblur ng-change="ctrl.refresh()"></textarea>
    </div>

  </div>

  <div ng-if="!ctrl.target.rawQuery">
    <!-- /////////////////////////////////// -->

    <div class="gf-form-inline">
      <div class="gf-form gf-form--grow">
        <label class="gf-form-label query-keyword width-7">数据源</label>
        <select class="gf-form-input width-10" placeholder="请选择" ng-model="ctrl.target.monitorType"
          ng-options="f.value as f.text for f in ctrl.monitorType" ng-change="ctrl.monitorTypeChanged()">
        </select>

        <select class="gf-form-input width-10" placeholder="请选择" ng-model="ctrl.target.monitorGroup"
          ng-options="f.value as f.text for f in ctrl.monitorGroup" ng-change="ctrl.monitorGroupChanged()">
        </select>

        <select class="gf-form-input width-16" placeholder="请选择" ng-model="ctrl.target.measurement"
          ng-options="f.value as f.text for f in ctrl.monitorMetric" ng-change="ctrl.monitorMetricChanged()">
        </select>

      </div>
    </div>

    <!-- select -->
    <div class="gf-form-inline" ng-repeat="selectParts in ctrl.queryModel.selectModels">
      <div class="gf-form" ng-style="{'visibility':$index === 0 ?'visible':'hidden'}">
        <label class="gf-form-label query-keyword width-7"> <span ng-show="$index === 0">值(select)</span>&nbsp; </label>
      </div>

      <div class="gf-form" ng-repeat="part in selectParts">
        <seraph-select model="segment" target="ctrl.target" index="$index" part="part"
          handle-event="ctrl.handleSelectPartEvent(selectParts, part, $event)"
          add-select="ctrl.addSelectPart(selectParts, $item, $event)" get-fields="ctrl.getSerapMonitorFiled()">
        </seraph-select>
      </div>
    </div>


    <!-- groupby -->
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-7"> <span>聚合规则(g)</span>&nbsp;
      </label>
    </div>
    <div class="gf-form-inline" ng-repeat="part in ctrl.queryModel.groupByParts">
      <!-- <div class="gf-form" ng-style="{'visibility':$index === 0 ?'visible':'hidden'}">
      <label class="gf-form-label query-keyword width-7"> <span ng-show="$index === 0">聚合规则(g)</span>&nbsp;
      </label>
    </div> -->

      <div class="gf-form offset-width-7">
        <seraph-groupby target="ctrl.target" index="$index" part="part" segment="ctrl.groupBySegment"
          handle-event="ctrl.handleGroupByPartEvent(part, $index, $event)" on-change="ctrl.groupByAction(part, $index)"
          get-fields="ctrl.getSerapMonitorTags()">
        </seraph-groupby>
      </div>
    </div>
    <div class="gf-form offset-width-7">
      <label class="gf-form-label">
        <a class=" pointer" ng-click="ctrl.addGroup()">
          <icon name="'plus'"></icon>
        </a>
      </label>
    </div>

    <!-- where -->
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-7"> <span>过滤规则</span>&nbsp; </label>
    </div>

    <div class="gf-form offset-width-7" ng-repeat="segment in ctrl.target.tags">
      <seraph-tag target="ctrl.target" index="$index" segment="segment"
        on-change="ctrl.tagSegmentUpdated2(segment, $index)" get-fields="ctrl.getSerapMonitorFiled()">
      </seraph-tag>
    </div>
    <div class="gf-form offset-width-7">
      <label class="gf-form-label">
        <a class=" pointer" ng-click="ctrl.addTag()">
          <icon name="'plus'"></icon>
        </a>
      </label>
    </div>
    <!-- where -->

    <div class="gf-form-inline">
      <div class="gf-form gf-form--grow">
        <label class="gf-form-label query-keyword width-7">别名</label>
        <input type="text" class="gf-form-input width-10" ng-model="ctrl.target.alias" spellcheck="false" placeholder=""
          ng-blur="ctrl.refresh()" />
      </div>
    </div>
  </div>
</query-editor-row>